import{a as x,v as C,A as te,o as r,b as q,w as _,g as l,d as e,e as a,u as s,aw as ie,l as v,t as u,F as se,z as oe,n as re,p as y,x as ue,y as ce,E as ae,aa as de,q as pe,ak as me,ax as ve,k as ye,G as fe}from"./index-WItOpbdS.js";import{a as ne}from"./axios-_QDD2PZU.js";import{m as z}from"./Money-BJRPvLN8.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as J}from"./copy-kcKq1M6K.js";import{X as E}from"./x-D_G4-85w.js";import{T as Z}from"./triangle-alert-WvWLgC-B.js";import{T as he,P as be}from"./thumbs-up-zL8bQz8Z.js";import{C as ge,a as _e}from"./chevron-right-o_L0fzR6.js";import{C as K}from"./circle-check-big-D4oY-uLV.js";import{C as le}from"./check-Bj0sAzNn.js";import{S as we}from"./shield-Be_G51qQ.js";import{A as ke}from"./award-BzMCt3sC.js";import{C as Ce}from"./calendar-uav1JtPz.js";import{R}from"./refresh-cw-Baqh8J4k.js";import{Z as H}from"./zap-Cbw5Ho42.js";import{C as Se}from"./credit-card-C9fkk2-U.js";import{H as $e}from"./history-DE24IReM.js";import{G as X}from"./gamepad-2-oAnktp6q.js";import{C as Pe}from"./clock-CtJexj6H.js";import{Y as Te,h as ee,G as je,V as Le,S as qe}from"./transition-Ck23AN9S.js";const Ae={key:0,class:"survey-overlay"},De={class:"survey-container"},Ie={class:"progress-container"},Ne={class:"survey-content"},Be={key:0,class:"survey-step"},Fe={class:"survey-icon warning"},Me={class:"survey-description"},Ve={class:"text-yellow-500 font-bold"},Ge={key:1,class:"survey-step"},Ue={class:"survey-title"},Ye={key:0,class:"choice-container"},Qe=["onClick"],Re={key:1,class:"text-container"},Ee=["placeholder"],We={class:"navigation-buttons"},Oe=["disabled"],ze={key:0},He={key:1},Ze={class:"question-counter"},Je={key:2,class:"survey-step"},Ke={class:"survey-icon success"},Xe={class:"promo-container"},et={class:"promo-label"},tt={class:"promo-code"},st={key:0,class:"copied-message"},ot={key:1,class:"promo-expiry"},rt={class:"survey-description"},at={__name:"CancellationSurvey",props:{initialDelay:{type:Number,default:0},discountPercentage:{type:Number,default:null},rejoinDays:{type:Number,default:30}},emits:["complete","close"],setup(S,{expose:W,emit:$}){const h=S,c=$,g=x(!1),b=x("intro"),i=x(0),p=x([]),P=x(""),T=x(null),j=x(!1),L=x(J),m=x([{id:"cancellation_reason",text:"What's the main reason you're cancelling?",type:"choice",options:["Too expensive","Not using it enough","Found a better alternative","Missing features I need","Technical issues","Just temporary - plan to come back","Other"],required:!0},{id:"features_missing",text:"Which features were most important to you?",type:"choice",options:["Game development tutorials","Asset downloads","Community support","Project templates","Code snippets","Advanced courses"],required:!0},{id:"price_perception",text:"What would be a fair monthly price for our service?",type:"choice",options:["Less than £5","£5 - £10","£10 - £15","£15 - £20","More than £20","Price wasn't the issue"],required:!0},{id:"return_likelihood",text:"How likely are you to return in the future?",type:"choice",options:["Very likely","Somewhat likely","Unsure","Somewhat unlikely","Very unlikely"],required:!0},{id:"improvement_feedback",text:"What could we improve to win you back?",type:"text",required:!1,placeholder:"Suggestions for improvements, features, or anything else on your mind..."}]),O=C(()=>te().props.surveyConfig||{}),w=C(()=>h.discountPercentage||O.value.cancellation_discount_percentage||20),A=C(()=>b.value==="intro"?0:b.value==="thanks"?100:i.value/m.value.length*100),d=C(()=>b.value!=="questions"||!m.value[i.value].required?!0:p.value[i.value]!==void 0&&p.value[i.value]!==""),t=C(()=>i.value===m.value.length-1),D=f=>{const o=new Date(f);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}).format(o)},I=()=>{g.value=!0,localStorage.setItem("cancellationSurveyShown","true")};function N(){b.value="questions",p.value=Array(m.value.length).fill("")}function B(f){p.value[i.value]=f}function F(){t.value?V():i.value++}function M(){i.value>0&&i.value--}let k=x(!1);async function V(){if(k.value)return;k.value=!0;const f={responses:m.value.map((o,n)=>({question_id:o.id,answer:p.value[n],question_text:o.text})),survey_type:"cancellation"};try{const o=await ne.post(route("survey.submit"),f);if(o.data&&o.data.success){if(o.data.message){const n=o.data.message;n.promoCode&&(P.value=n.promoCode),n.expiry&&(T.value=n.expiry),n.discountPercentage&&(w.value=n.discountPercentage)}b.value="thanks",c("complete",{answers:p.value,questions:m.value})}}catch(o){console.error("Failed to submit cancellation survey:",o),b.value="thanks"}finally{k.value=!1}}function G(){navigator.clipboard.writeText(P.value).then(()=>{j.value=!0,L.value=le,setTimeout(()=>{j.value=!1,L.value=J},2e3)}).catch(f=>{console.error("Failed to copy promo code:",f)})}function U(){g.value=!1,c("close")}function Y(){g.value=!1,c("close")}return W({openSurvey:I}),(f,o)=>(r(),q(de,{name:"fade"},{default:_(()=>[g.value?(r(),l("div",Ae,[e("div",De,[e("button",{onClick:U,class:"close-button"},[a(s(E),{class:"w-5 h-5"})]),e("div",Ie,[e("div",{class:"progress-bar",style:ie({width:`${A.value}%`})},null,4)]),e("div",Ne,[b.value==="intro"?(r(),l("div",Be,[e("div",Fe,[a(s(Z),{class:"w-10 h-10 text-yellow-500"})]),o[3]||(o[3]=e("h3",{class:"survey-title"},"We're Sorry to See You Go",-1)),e("p",Me,[o[1]||(o[1]=v(" Your feedback helps us improve. Tell us why you're cancelling and get a ")),e("span",Ve,u(w.value)+"% discount",1),v(" to come back anytime within "+u(S.rejoinDays)+" days. ",1)]),e("button",{onClick:N,class:"primary-button"},[a(s(he),{class:"w-4 h-4 mr-2"}),o[2]||(o[2]=e("span",null,"Share Feedback",-1))]),o[4]||(o[4]=e("div",{class:"survey-footnote"}," Takes just 30 seconds, and helps us serve you better ",-1))])):b.value==="questions"?(r(),l("div",Ge,[e("h3",Ue,u(m.value[i.value].text),1),m.value[i.value].type==="choice"?(r(),l("div",Ye,[(r(!0),l(se,null,oe(m.value[i.value].options,(n,Q)=>(r(),l("div",{key:Q,onClick:zt=>B(n),class:re(["choice-option",p.value[i.value]===n?"choice-selected":""])},u(n),11,Qe))),128))])):y("",!0),m.value[i.value].type==="text"?(r(),l("div",Re,[ue(e("textarea",{"onUpdate:modelValue":o[0]||(o[0]=n=>p.value[i.value]=n),class:"text-input",placeholder:m.value[i.value].placeholder,rows:"3"},null,8,Ee),[[ce,p.value[i.value]]])])):y("",!0),e("div",We,[i.value>0?(r(),l("button",{key:0,onClick:M,class:"secondary-button"},[a(s(ge),{class:"w-4 h-4 mr-1"}),o[5]||(o[5]=v(" Back "))])):y("",!0),e("button",{onClick:F,class:"primary-button",disabled:!d.value},[t.value?(r(),l("span",ze,"Finish")):(r(),l("span",He,"Next")),t.value?(r(),q(s(K),{key:3,class:"w-4 h-4 ml-1"})):(r(),q(s(_e),{key:2,class:"w-4 h-4 ml-1"}))],8,Oe)]),e("div",Ze," Question "+u(i.value+1)+"/"+u(m.value.length),1)])):b.value==="thanks"?(r(),l("div",Je,[e("div",Ke,[a(s(be),{class:"w-10 h-10 text-primary-500"})]),o[7]||(o[7]=e("h3",{class:"survey-title"},"Thanks for Your Feedback!",-1)),e("div",Xe,[e("div",et,"Your "+u(w.value)+"% Comeback Discount:",1),e("div",tt,[e("span",null,u(P.value),1),e("button",{onClick:G,class:"copy-button"},[(r(),q(ae(L.value),{class:"w-4 h-4"}))])]),j.value?(r(),l("div",st," Copied to clipboard! ")):y("",!0),T.value?(r(),l("div",ot," Valid until: "+u(D(T.value)),1)):y("",!0)]),e("p",rt," Miss us and want to come back? Use this code at checkout for "+u(w.value)+"% off when you rejoin. ",1),e("button",{onClick:Y,class:"primary-button"},[a(s(K),{class:"w-4 h-4 mr-2"}),o[6]||(o[6]=e("span",null,"Got it, Thanks",-1))])])):y("",!0)])])])):y("",!0)]),_:1}))}},nt=xe(at,[["__scopeId","data-v-7d7b85e0"]]),lt={class:"max-w-7xl mx-auto"},it={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},ut={class:"bg-gradient-to-br from-dark-200 to-dark-100 p-6 rounded-xl shadow-lg border border-purple-500/30"},ct={class:"flex items-center justify-between mb-4"},dt={class:"flex items-center"},pt={key:0,class:"px-2 py-1 bg-green-500/20 text-green-400 text-xs font-medium rounded-full border border-green-500/30 flex items-center"},mt={class:"space-y-3"},vt={class:"text-2xl font-bold text-white"},yt={key:0,class:"text-sm text-gray-400"},ft={class:"bg-dark-300/50 p-3 rounded-lg border border-purple-500/10 flex items-center mt-3"},xt={class:"bg-dark-100 p-6 rounded-xl shadow-lg border border-blue-500/30"},ht={class:"flex items-center justify-between mb-4"},bt={class:"flex items-center"},gt={class:"space-y-1"},_t={key:0,class:"text-2xl font-bold text-white"},wt={key:1,class:"text-sm text-gray-400 flex items-center"},kt={key:2,class:"text-sm text-red-400 flex items-center"},Ct={key:3,class:"text-sm text-gray-400"},St={class:"bg-dark-100 p-6 rounded-xl shadow-lg border border-green-500/30"},$t={class:"flex items-center mb-4"},Pt={class:"flex flex-col gap-3"},Tt={class:"bg-dark-100 rounded-xl shadow-lg border border-gray-700 overflow-hidden"},jt={class:"p-4 border-b border-dark-300 bg-dark-200 flex items-center"},Lt={class:"overflow-x-auto"},qt={class:"w-full"},At={class:"divide-y divide-dark-300"},Dt={class:"py-4 px-6 text-sm text-gray-300"},It={class:"py-4 px-6 text-sm text-white font-medium"},Nt={class:"py-4 px-6 text-sm text-gray-300"},Bt={class:"py-4 px-6"},Ft={class:"py-4 px-6 text-sm text-gray-300"},Mt={key:0,class:"py-12 text-center"},Vt={class:"fixed inset-0 overflow-y-auto"},Gt={class:"flex min-h-full items-center justify-center p-4"},Ut={class:"p-6 bg-dark-200 border-b border-red-500/20"},Yt={class:"p-6"},Qt={class:"flex justify-center mb-6"},Rt={class:"bg-red-500/10 border border-red-500/20 rounded-lg p-4 mb-6"},Et={class:"text-gray-300 text-center"},Wt={class:"text-white font-medium block mt-1"},Ot={class:"flex gap-3"},fs=pe({__name:"SubscriptionManagement",props:{subscriptions:{type:Object,required:!0}},emits:["isLoading","displaySubscription"],setup(S,{emit:W}){var A;const $=me("route"),h=W,c=C(()=>{var d,t;return(t=(d=te().props.authUserInfo)==null?void 0:d.data)==null?void 0:t.subscription}),g=x(!1),b=ve({auto_renew:(A=c.value)==null?void 0:A.auto_renew}),i=x(null),p=d=>new Date(d).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),P=d=>({active:"bg-green-500/20 text-green-400 border-green-500/30",cancelled:"bg-red-500/20 text-red-400 border-red-500/30",expired:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",pending:"bg-blue-500/20 text-blue-400 border-blue-500/30"})[d.toLowerCase()]||"bg-gray-500/20 text-gray-400 border-gray-500/30",T=d=>({active:H,cancelled:E,expired:Pe,pending:R})[d.toLowerCase()]||R,j=()=>{h("isLoading",!0),b.post($("payment.toggle-auto-renew"),{preserveState:!0,onSuccess:()=>h("isLoading",!1),onError:()=>h("isLoading",!1)})};ye(()=>{localStorage.getItem("cancellationSurveyShown")==="pending"&&setTimeout(()=>{i.value&&i.value.openSurvey()},500)});const L=()=>{h("isLoading",!0),fe.post($("payment.cancel-subscription"),null,{preserveState:!0,onSuccess:()=>{h("isLoading",!1),g.value=!1,localStorage.setItem("cancellationSurveyShown","pending"),setTimeout(()=>{i.value&&i.value.openSurvey()},500)},onError:()=>h("isLoading",!1)})},m=d=>{localStorage.removeItem("cancellationSurveyShown"),console.log("Survey completed",d)},O=()=>{h("displaySubscription",!0)},w=()=>{h("isLoading",!0),ne.post($("payment.update-method")).then(d=>{window.location.href=d.data.session}).catch(()=>h("isLoading",!1))};return(d,t)=>{var D,I,N,B,F,M,k,V,G,U,Y,f,o;return r(),l("div",lt,[t[21]||(t[21]=e("div",{class:"mb-8 text-center"},[e("h1",{class:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 via-blue-400 to-green-400 mb-2"}," PLAYER SUBSCRIPTION "),e("div",{class:"w-24 h-1 bg-gradient-to-r from-purple-500 via-blue-500 to-green-500 mx-auto rounded-full"})],-1)),e("div",it,[e("div",ut,[e("div",ct,[e("div",dt,[a(s(we),{class:"h-5 w-5 text-purple-400 mr-2"}),t[3]||(t[3]=e("h3",{class:"text-purple-400 text-sm font-medium"},"Current Plan",-1))]),(D=c.value)!=null&&D.auto_renew?(r(),l("div",pt,[a(s(le),{class:"h-3 w-3 mr-1"}),t[4]||(t[4]=v(" Active "))])):y("",!0)]),e("div",mt,[e("h2",vt,u(((N=(I=c.value)==null?void 0:I.plan)==null?void 0:N.name)||"Free Plan"),1),(B=c.value)!=null&&B.plan?(r(),l("p",yt,u(s(z)(c.value.plan.price))+" / month ",1)):y("",!0),e("div",ft,[a(s(ke),{class:"h-4 w-4 text-yellow-400 mr-2"}),t[5]||(t[5]=e("span",{class:"text-sm text-gray-300"},"Premium features unlocked",-1))])])]),e("div",xt,[e("div",ht,[e("div",bt,[a(s(Ce),{class:"h-5 w-5 text-blue-400 mr-2"}),t[6]||(t[6]=e("h3",{class:"text-blue-400 text-sm font-medium"},"Next Billing",-1))]),(F=c.value)!=null&&F.auto_renew?(r(),l("button",{key:0,onClick:j,class:"text-xs flex items-center text-blue-400 hover:text-blue-300 transition-colors"},[a(s(R),{class:"h-3 w-3 mr-1"}),t[7]||(t[7]=v(" Manage Auto-renew "))])):y("",!0)]),e("div",gt,[(M=c.value)!=null&&M.plan?(r(),l("h2",_t,u(p(c.value.renovation_at)),1)):y("",!0),(k=c.value)!=null&&k.auto_renew?(r(),l("p",wt,[a(s(R),{class:"h-3 w-3 mr-1"}),v(" Auto-renews for "+u(s(z)((G=(V=c.value)==null?void 0:V.plan)==null?void 0:G.price)),1)])):(U=c.value)!=null&&U.plan?(r(),l("p",kt,[a(s(Z),{class:"h-3 w-3 mr-1"}),t[8]||(t[8]=v(" Will not auto-renew "))])):(r(),l("p",Ct," No active subscription "))])]),e("div",St,[e("div",$t,[a(s(H),{class:"h-5 w-5 text-green-400 mr-2"}),t[9]||(t[9]=e("h3",{class:"text-green-400 text-sm font-medium"},"Quick Actions",-1))]),e("div",Pt,[(Y=c.value)!=null&&Y.plan?y("",!0):(r(),l("button",{key:0,onClick:O,class:"w-full px-4 py-3 bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white rounded-lg transition-colors text-sm font-medium flex items-center justify-center"},[a(s(H),{class:"h-4 w-4 mr-2"}),t[10]||(t[10]=v(" Upgrade Plan "))])),e("button",{onClick:w,class:"w-full px-4 py-3 bg-dark-300 hover:bg-dark-400 text-white rounded-lg transition-colors text-sm font-medium flex items-center justify-center"},[a(s(Se),{class:"h-4 w-4 mr-2"}),t[11]||(t[11]=v(" Manage Billing "))]),(f=c.value)!=null&&f.plan&&c.value.auto_renew?(r(),l("button",{key:1,onClick:t[0]||(t[0]=n=>g.value=!0),class:"w-full px-4 py-3 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg transition-colors text-sm font-medium border border-red-500/30 flex items-center justify-center"},[a(s(E),{class:"h-4 w-4 mr-2"}),t[12]||(t[12]=v(" Cancel Plan "))])):y("",!0)])])]),e("div",Tt,[e("div",jt,[a(s($e),{class:"h-5 w-5 text-gray-400 mr-2"}),t[13]||(t[13]=e("h2",{class:"text-lg font-semibold text-white"},"Subscription History",-1))]),e("div",Lt,[e("table",qt,[t[14]||(t[14]=e("thead",null,[e("tr",{class:"text-left border-b border-dark-300 bg-dark-200/50"},[e("th",{class:"py-3 px-6 text-xs font-medium text-gray-400"},"Date"),e("th",{class:"py-3 px-6 text-xs font-medium text-gray-400"},"Plan"),e("th",{class:"py-3 px-6 text-xs font-medium text-gray-400"},"Amount"),e("th",{class:"py-3 px-6 text-xs font-medium text-gray-400"},"Status"),e("th",{class:"py-3 px-6 text-xs font-medium text-gray-400"},"Period")])],-1)),e("tbody",At,[(r(!0),l(se,null,oe(S.subscriptions.data,(n,Q)=>(r(),l("tr",{key:Q,class:"hover:bg-dark-200 transition-colors"},[e("td",Dt,u(p(n.start_date_at)),1),e("td",It,u(n.plan.name),1),e("td",Nt,u(s(z)(n.plan.price)),1),e("td",Bt,[e("span",{class:re(["px-2 py-1 text-xs font-medium rounded-full flex items-center w-fit border",P(n.status)])},[(r(),q(ae(T(n.status)),{class:"h-3 w-3 mr-1"})),v(" "+u(n.status),1)],2)]),e("td",Ft,u(p(n.start_date_at))+" - "+u(p(n.end_date_at)),1)]))),128))])]),(o=S.subscriptions.data)!=null&&o.length?y("",!0):(r(),l("div",Mt,[a(s(X),{class:"h-12 w-12 text-gray-600 mx-auto mb-3 opacity-50"}),t[15]||(t[15]=e("p",{class:"text-gray-400"},"No subscription history available",-1)),t[16]||(t[16]=e("p",{class:"text-gray-500 text-sm mt-1"},"Your adventure is just beginning",-1))]))])]),a(s(qe),{appear:"",show:g.value,as:"template"},{default:_(()=>[a(s(Te),{as:"div",onClose:t[2]||(t[2]=n=>g.value=!1),class:"relative z-50"},{default:_(()=>[a(s(ee),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:_(()=>t[17]||(t[17]=[e("div",{class:"fixed inset-0 bg-black/75"},null,-1)])),_:1}),e("div",Vt,[e("div",Gt,[a(s(ee),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:_(()=>[a(s(je),{class:"w-full max-w-md bg-gradient-to-br from-dark-200 to-dark-100 rounded-xl overflow-hidden shadow-xl border border-red-500/30"},{default:_(()=>{var n;return[e("div",Ut,[a(s(Le),{class:"text-xl font-semibold text-white text-center flex items-center justify-center"},{default:_(()=>[a(s(Z),{class:"h-5 w-5 text-red-400 mr-2"}),t[18]||(t[18]=v(" Cancel Subscription "))]),_:1})]),e("div",Yt,[e("div",Qt,[a(s(X),{class:"h-20 w-20 text-red-400 opacity-75"})]),e("div",Rt,[e("p",Et,[t[19]||(t[19]=v(" Are you sure you want to cancel your subscription? Your access to premium features will continue until ")),e("span",Wt,u(p((n=c.value)==null?void 0:n.renovation_at)),1)])]),e("div",Ot,[e("button",{onClick:t[1]||(t[1]=Q=>g.value=!1),class:"flex-1 px-4 py-3 bg-dark-300 hover:bg-dark-400 text-white rounded-lg transition-colors text-sm font-medium"}," Keep Subscription "),e("button",{onClick:L,class:"flex-1 px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg transition-colors text-sm font-medium flex items-center justify-center"},[a(s(E),{class:"h-4 w-4 mr-2"}),t[20]||(t[20]=v(" Confirm Cancel "))])])])]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]),a(nt,{ref_key:"cancellationSurvey",ref:i,onComplete:m},null,512)])}}});export{fs as _};
