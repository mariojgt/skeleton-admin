import{a as c,A as m,p as C,B as j,C as _,o as u,g as p,d as t,l as y,t as a,s as v,v as L,z as B,u as S,D as R}from"./preset-fafa7a54.js";const U={class:"min-h-screen bg-base-200 p-6"},E={class:"container mx-auto"},O={class:"card bg-base-100 shadow-xl"},P={class:"card-body"},T={class:"flex justify-between items-center mb-4"},V={class:"card-title text-2xl flex items-center gap-2"},$={class:"bg-base-200 p-4 rounded-lg mb-4"},A={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},I={class:"font-medium"},M={class:"font-medium"},z={class:"font-mono text-sm"},H={class:"font-mono text-sm"},N={class:"mb-6"},F={class:"flex justify-between items-center mb-2"},q={class:"text-sm opacity-70"},G=["value"],J={class:"bg-base-300 rounded-lg"},K={class:"flex items-center justify-between p-4 border-b border-base-content/10"},Q={class:"flex gap-2"},W={class:"h-[400px] overflow-y-auto font-mono text-sm p-4 space-y-2"},Y={__name:"DeployStatus",props:{deployment:{type:Object,default:()=>({})}},setup(n){const d=n;c("running");const h=c(!0);let i=c([]);const r=async()=>{try{const e=await(await fetch(route("deployments.logs",d.deployment.id))).json();i.value=e.data}catch(s){console.error("Error fetching logs:",s)}},b=m(()=>i.value.filter(s=>s.type==="success").length),g=m(()=>d.deployment.progress.total||0),f=m(()=>b.value/g.value*100||0),w=s=>s?R(new Date(s),"HH:mm:ss"):"";C(()=>{d.deployment&&(r(),setInterval(r,5e3))}),j(()=>d.deployment,s=>{s&&r()});const k=()=>{const s=i.value.map(x=>`[${w(x.timestamp)}] ${x.content}`).join(`
`),e=new Blob([s],{type:"text/plain"}),o=window.URL.createObjectURL(e),l=document.createElement("a");l.href=o,l.download=`deployment-${d.deployment.id}-logs.txt`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(o),document.body.removeChild(l)},D=async()=>{if(confirm("Are you sure you want to cancel this deployment?"))try{await fetch(`/api/deployments/${d.deploymentId}/cancel`,{method:"POST"}),await fetchDeployment()}catch(s){console.error("Error canceling deployment:",s)}};return _(()=>{clearInterval(r)}),(s,e)=>(u(),p("div",U,[t("div",E,[t("div",O,[t("div",P,[t("div",T,[t("h2",V,[e[0]||(e[0]=t("span",null,"Deployment Status",-1)),t("div",{class:y(["badge badge-lg",{"badge-warning animate-pulse":n.deployment.status==="running","badge-success":n.deployment.status==="completed","badge-error":n.deployment.status==="failed","badge-info":n.deployment.status==="pending"}])},a(n.deployment.status),3)]),e[1]||(e[1]=t("div",{class:"flex items-center gap-4"},[t("div",{class:"text-sm opacity-70"}," Started: 2024-10-26 14:30:00 "),t("div",{class:"text-sm opacity-70"}," Duration: 2m 45s ")],-1))]),t("div",$,[t("div",A,[t("div",null,[e[2]||(e[2]=t("div",{class:"text-sm opacity-70"},"Repository",-1)),t("div",I,a(n.deployment.metadata.repository_name),1)]),t("div",null,[e[3]||(e[3]=t("div",{class:"text-sm opacity-70"},"Branch",-1)),t("div",M,a(n.deployment.webhook_config.branch),1)]),t("div",null,[e[4]||(e[4]=t("div",{class:"text-sm opacity-70"},"Commit",-1)),t("div",z,a(n.deployment.commit_hash),1)]),t("div",null,[e[5]||(e[5]=t("div",{class:"text-sm opacity-70"}," Deployment Path ",-1)),t("div",H,a(n.deployment.webhook_config.deployment_path),1)])])]),t("div",N,[t("div",F,[e[6]||(e[6]=t("div",{class:"font-medium"},"Deployment Progress",-1)),t("div",q,a(b.value)+"/"+a(g.value)+" commands completed ",1)]),t("progress",{class:"progress progress-primary w-full",value:f.value,max:"100"},null,8,G),v(" "+a(f.value),1)]),t("div",J,[t("div",K,[e[9]||(e[9]=t("h3",{class:"font-bold"},"Deployment Logs",-1)),t("div",Q,[t("button",{class:"btn btn-sm btn-ghost",onClick:k},e[7]||(e[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),v(" Download Logs ")])),t("button",{class:y(["btn btn-sm btn-ghost",{"btn-active":h.value}])},e[8]||(e[8]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13l-3 3m0 0l-3-3m3 3V8"})],-1),v(" Auto-scroll ")]),2)])]),t("div",W,[(u(!0),p(L,null,B(S(i),(o,l)=>(u(),p("div",{key:l},[t("div",{class:y({"text-primary":o.type==="info","text-info":o.type==="command","text-success":o.type==="success","text-error":o.type==="error","text-warning animate-pulse":o.type==="running","pl-4":o.indented})}," ["+a(w(o.timestamp))+"] "+a(o.content),3)]))),128))])]),t("div",{class:"flex justify-between items-center mt-4"},[t("div",{class:"flex gap-2"},[t("button",{class:"btn btn-error btn-sm",onClick:D}," Cancel Deployment ")]),e[10]||(e[10]=t("div",{class:"flex gap-2"},[t("div",{class:"badge badge-neutral"}," webhook-id: 123 "),t("div",{class:"badge badge-neutral"}," deploy-id: 456 ")],-1))])])])])]))}};export{Y as default};
